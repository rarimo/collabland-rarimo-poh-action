configVersion: 1
project: 'collabland-rarimo-poh-action'
---
image: builder
from: node:18.14.2-alpine
git:
- add: /
  to: /app
  excludePaths:
  - .helm
  - Dockerfile
  stageDependencies:
    install:
    - package.json
    - yarn.lock
    setup:
    - "**/*"
shell:
  install:
  - cd /app
  - npm i -g @vercel/ncc pkg
  - yarn install
  setup:
  - cd /app
  - yarn build
  - ncc build ./dist/bin/www.js
  - pkg -t node18-alpine-x64 ./dist/index.js  -o /usr/local/bin/www

---
image: service
from: node:18.14.2-alpine
docker:
  ENTRYPOINT: api
import:
  - image: builder
    add: /usr/local/bin/www
    to: /usr/local/bin/www
    after: setup


